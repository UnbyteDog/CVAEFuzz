# Analysis & Reporter å®ç°å®ŒæˆæŠ¥å‘Š

## âœ… å®ç°æ¦‚è¿°

è‰¹ï¼è€ç‹æˆ‘å®Œæˆäº†ä¸“ä¸šçš„æ‰«æç»“æœåˆ†æå’ŒæŠ¥å‘Šç”Ÿæˆç³»ç»Ÿï¼è¿™ä¸ªç³»ç»Ÿå¯ä»¥å¯¹æ‰«æç»“æœè¿›è¡Œåå¤„ç†ã€å»é‡ã€è¯„çº§ï¼Œå¹¶ç”Ÿæˆæ¼‚äº®çš„æŠ¥å‘Šï¼

**æ–‡ä»¶ä½ç½®**ï¼š
- `Fuzz/BaseFuzz/analysis/analyzer.py` - åˆ†æå™¨
- `Fuzz/BaseFuzz/analysis/reporter.py` - æŠ¥å‘Šç”Ÿæˆå™¨
- `Fuzz/BaseFuzz/analysis/test_analysis_integration.py` - é›†æˆæµ‹è¯•

---

## ğŸ”¥ analyzer.py - æ‰«æç»“æœåˆ†æå™¨

### æ ¸å¿ƒåŠŸèƒ½

#### 1. **å»é‡é€»è¾‘ (_deduplicate)**

**å”¯ä¸€æ ‡è¯†ç”Ÿæˆ**ï¼š
```python
unique_key = f"{vuln_type}_{param_name}_{payload[:50]}"
```

**å»é‡ç­–ç•¥**ï¼š
- åŸºäºå”¯ä¸€æ ‡è¯†å»é‡
- ä¿ç•™ç½®ä¿¡åº¦æœ€é«˜çš„ç‰ˆæœ¬
- ä¿ç•™æœ€æ—©å‘ç°çš„ç‰ˆæœ¬

**ç¤ºä¾‹**ï¼š
```python
# åŸå§‹ç»“æœ: 6æ¡
# å»é‡å: 4æ¡
# (å»é™¤é‡å¤çš„SQLiæŠ¥é”™æ³¨å…¥)
```

#### 2. **ä¸¥é‡æ€§é‡è¯„çº§ (_rank)**

**ç»Ÿä¸€æ˜ å°„è§„åˆ™**ï¼š
```python
SEVERITY_MAPPING = {
    # SQLæ³¨å…¥
    'SQLi_Error-Based': 'High',
    'SQLi_Boolean-Based': 'Medium',
    'SQLi_Time-Based': 'Medium',
    'SQLi_Union-Based': 'High',

    # XSS
    'XSS_Reflected_script_tag': 'High',
    'XSS_Reflected_event_handler': 'Medium',
    'XSS_Reflected_text_content': 'Low',
    'XSS_DOM-Based': 'Low',
}
```

**ç½®ä¿¡åº¦è°ƒæ•´**ï¼š
```python
severity_bonus = {
    'High': +0.1,    # é«˜å±æå‡ç½®ä¿¡åº¦
    'Medium': 0.0,   # ä¸­å±ä¿æŒ
    'Low': -0.1,     # ä½å±é™ä½ç½®ä¿¡åº¦
}
adjusted_conf = min(max(original_conf + bonus, 0.0), 1.0)
```

#### 3. **ç»Ÿè®¡åˆ†æ (get_statistics)**

**ç»Ÿè®¡ç»´åº¦**ï¼š
- æ€»æ¼æ´æ•°
- æŒ‰ä¸¥é‡æ€§åˆ†ç»„ï¼ˆHigh/Medium/Lowï¼‰
- æŒ‰ç±»å‹åˆ†ç»„ï¼ˆSQLi/XSS/etc.ï¼‰
- æŒ‰å‚æ•°åˆ†ç»„ï¼ˆå‰10ä¸ªæœ€å±é™©å‚æ•°ï¼‰
- å¹³å‡ç½®ä¿¡åº¦
- é£é™©æŒ‡æ•°ï¼ˆç»¼åˆè¯„åˆ†ï¼‰

**é£é™©æŒ‡æ•°è®¡ç®—**ï¼š
```python
RISK_WEIGHTS = {
    'High': 10.0,
    'Medium': 5.0,
    'Low': 1.0,
}

risk_index = sum(
    RISK_WEIGHTS[severity] * confidence
    for vuln in results
)
```

#### 4. **å¥å£®æ€§è®¾è®¡**

**é™çº§å¤„ç†**ï¼š
- JSONæ–‡ä»¶æŸå â†’ è¿”å›ç©ºåˆ—è¡¨
- æ–‡ä»¶ä¸å­˜åœ¨ â†’ è¿”å›Falseï¼Œè®°å½•é”™è¯¯æ—¥å¿—
- æ•°æ®æ ¼å¼é”™è¯¯ â†’ ä¿ç•™åŸå§‹æ•°æ®ï¼Œè·³è¿‡é”™è¯¯é¡¹
- å¼‚å¸¸æ•è· â†’ æ¯ä¸ªç»“æœéƒ½æœ‰try-exceptä¿æŠ¤

---

## ğŸ”¥ reporter.py - æŠ¥å‘Šç”Ÿæˆå™¨

### æ ¸å¿ƒåŠŸèƒ½

#### 1. **æ±‡æ€»ç»Ÿè®¡ (generate_summary)**

**ç”Ÿæˆå†…å®¹**ï¼š
- æ‰«ææ€»æ—¶é•¿
- ç›®æ ‡æ€»æ•°
- å·²æµ‹è¯•å‚æ•°é‡
- æŒ‰ä¸¥é‡æ€§æ’åˆ—çš„æ¼æ´æ€»æ•°
- WAFæ‹¦æˆªæ¯”ä¾‹ï¼ˆæœªæ¥æ‰©å±•ï¼‰
- å¹³å‡ç½®ä¿¡åº¦
- é£é™©æŒ‡æ•°

#### 2. **å¤šæ ·åŒ–è¾“å‡º**

**A. JSONæŠ¥å‘Š**ï¼š
- `summary.json` - æ±‡æ€»ç»Ÿè®¡ + Top10æ¼æ´
- `vulnerabilities_detail.json` - å®Œæ•´è¯¦ç»†æ•°æ®

**JSONç»“æ„**ï¼š
```json
{
  "scan_info": {
    "start_time": "2025-12-25 10:00:00",
    "end_time": "2025-12-25 10:05:00",
    "total_targets": 5,
    "engines_used": ["sqli", "xss"]
  },
  "statistics": {
    "total_vulns": 10,
    "by_severity": {"High": 3, "Medium": 5, "Low": 2},
    "avg_confidence": 0.75,
    "risk_index": 45.5
  },
  "vulnerabilities": [...],
  "generated_at": "2025-12-25 10:10:00"
}
```

**B. ç»ˆç«¯æ±‡æ€» (Console Summary)**ï¼š
- ä½¿ç”¨coloramaå½©è‰²è¾“å‡º
- ASCIIè¡¨æ ¼å±•ç¤ºï¼ˆtabulateï¼‰
- æ¸…æ™°çš„æˆ˜æœå±•ç¤º

**ç»ˆç«¯è¾“å‡ºç¤ºä¾‹**ï¼š
```
======================================================================
          CVDBFuzz æ¼æ´æ‰«ææŠ¥å‘Š
======================================================================

ğŸ“Š æ‰«æä¿¡æ¯
----------------------------------------------------------------------
  å¼€å§‹æ—¶é—´: 2025-12-25 10:00:00
  ç»“æŸæ—¶é—´: 2025-12-25 10:05:00
  ç›®æ ‡æ•°é‡: 3
  æµ‹è¯•å‚æ•°: 5
  ä½¿ç”¨å¼•æ“: sqli, xss

ğŸ¯ æ‰«æç»Ÿè®¡
----------------------------------------------------------------------
  æ€»æ¼æ´æ•°: 4
  é«˜å±æ¼æ´: 2
  ä¸­å±æ¼æ´: 1
  ä½å±æ¼æ´: 1
  å¹³å‡ç½®ä¿¡åº¦: 0.79
  é£é™©æŒ‡æ•°: 23.50

ğŸ“ˆ æ¼æ´åˆ†å¸ƒ
----------------------------------------------------------------------
+----+-----------+-----------+---------+
| ä¸¥é‡æ€§ | æ•°é‡       |
+====+===========+=========+
| é«˜å±   | 2         |
+----+-----------+-----------+
| ä¸­å±   | 1         |
+----+-----------+-----------+
| ä½å±   | 1         |
+----+-----------+-----------+
```

**C. è·¯å¾„ç®¡ç†**ï¼š
```python
# è‡ªåŠ¨åˆ›å»ºç›®å½•
output_dir = 'Results/scan_20251225_100000/'

# æ–‡ä»¶è·¯å¾„
{
    'summary': 'Results/scan_20251225_100000/summary.json',
    'detail': 'Results/scan_20251225_100000/vulnerabilities_detail.json',
    'console': 'Results/scan_20251225_100000/console_report.txt',
    'directory': 'Results/scan_20251225_100000',
}
```

---

## ğŸ“‹ æŠ€æœ¯è§„èŒƒå®ç°æ¸…å•

### âœ… **analyzer.py - åˆ†æå™¨**

- [x] **å»é‡é€»è¾‘ (_deduplicate)**
  - åŸºäºå”¯ä¸€æ ‡è¯† `f"{vuln_type}_{param}_{payload[:50]}"` å»é‡
  - ä¿ç•™ç½®ä¿¡åº¦æœ€é«˜çš„ç‰ˆæœ¬
  - ä¿ç•™æœ€æ—©å‘ç°çš„ç‰ˆæœ¬

- [x] **ä¸¥é‡æ€§é‡è¯„çº§ (_rank)**
  - æŠ¥é”™æ³¨å…¥/å‘½ä»¤æ‰§è¡Œ â†’ High
  - ç›²æ³¨/åå°„å‹XSS â†’ Medium
  - ä¿¡æ¯æ³„éœ²/DOMé£é™© â†’ Low
  - ç½®ä¿¡åº¦æ±‡æ€»ä¸è°ƒæ•´

- [x] **ç»Ÿè®¡åˆ†æ**
  - æŒ‰ç±»å‹åˆ†ç»„
  - æŒ‰ä¸¥é‡æ€§åˆ†ç»„
  - æŒ‰å‚æ•°åˆ†ç»„
  - è®¡ç®—å¹³å‡ç½®ä¿¡åº¦
  - è®¡ç®—é£é™©æŒ‡æ•°

- [x] **å¥å£®æ€§**
  - JSONæŸå â†’ å¹³ç¨³é™çº§
  - æ–‡ä»¶ä¸ºç©º â†’ è¿”å›ç©ºåˆ—è¡¨
  - å¼‚å¸¸æ•è· â†’ ä¸ä¸­æ–­æµç¨‹

### âœ… **reporter.py - æŠ¥å‘Šç”Ÿæˆå™¨**

- [x] **æ±‡æ€»ç»Ÿè®¡ (generate_summary)**
  - æ‰«ææ€»æ—¶é•¿
  - ç›®æ ‡æ€»æ•°
  - å·²æµ‹è¯•å‚æ•°é‡
  - æ¼æ´æ€»æ•°ï¼ˆæŒ‰ä¸¥é‡æ€§æ’åˆ—ï¼‰
  - WAFæ‹¦æˆªæ¯”ä¾‹ï¼ˆæ¡†æ¶æ”¯æŒï¼‰

- [x] **å¤šæ ·åŒ–è¾“å‡º**
  - JSONæŠ¥å‘Šï¼ˆå®Œæ•´è¯¦ç»†æ•°æ®ï¼‰
  - ç»ˆç«¯æ±‡æ€»ï¼ˆå½©è‰²ASCIIè¡¨æ ¼ï¼‰
  - æ–‡æœ¬æŠ¥å‘Šï¼ˆçº¯æ–‡æœ¬æ ¼å¼ï¼‰

- [x] **è·¯å¾„ç®¡ç†**
  - è‡ªåŠ¨åˆ›å»º `Data/scan_results/{site_name}/` ç›®å½•
  - ç»Ÿä¸€å‘½åè§„èŒƒ
  - è¿”å›æ–‡ä»¶è·¯å¾„å­—å…¸

- [x] **å½©è‰²è¾“å‡º**
  - coloramaæ”¯æŒï¼ˆå¯é€‰ï¼‰
  - tabulateè¡¨æ ¼ï¼ˆå¯é€‰ï¼‰
  - é™çº§åˆ°ç®€å•æ ¼å¼

---

## ğŸ¯ å®Œæ•´åˆ†ææµç¨‹

```
æ‰«æå®Œæˆ
    â†“
vulnerabilities.json (åŸå§‹ç»“æœ)
    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Analyzer.load_results()          â”‚
â”‚ - è¯»å–JSONæ–‡ä»¶                    â”‚
â”‚ - éªŒè¯æ•°æ®æ ¼å¼                    â”‚
â”‚ - é™çº§å¤„ç†å¼‚å¸¸                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Analyzer.deduplicate()           â”‚
â”‚ - ç”Ÿæˆå”¯ä¸€æ ‡è¯†                    â”‚
â”‚ - å»é™¤é‡å¤ç»“æœ                    â”‚
â”‚ - ä¿ç•™é«˜ç½®ä¿¡åº¦ç‰ˆæœ¬                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Analyzer.rank()                  â”‚
â”‚ - é‡æ–°è¯„çº§ä¸¥é‡æ€§                  â”‚
â”‚ - è°ƒæ•´ç½®ä¿¡åº¦                      â”‚
â”‚ - æŒ‰é£é™©æ’åº                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Analyzer.get_statistics()        â”‚
â”‚ - æŒ‰ä¸¥é‡æ€§åˆ†ç»„                    â”‚
â”‚ - æŒ‰ç±»å‹åˆ†ç»„                      â”‚
â”‚ - è®¡ç®—é£é™©æŒ‡æ•°                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Reporter.generate_summary()      â”‚
â”‚ - ç”ŸæˆJSONè¯¦ç»†æŠ¥å‘Š                â”‚
â”‚ - ç”ŸæˆJSONæ±‡æ€»æŠ¥å‘Š                â”‚
â”‚ - ç”Ÿæˆç»ˆç«¯å½©è‰²æ±‡æ€»                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â†“
æŠ¥å‘Šæ–‡ä»¶:
  - summary.json
  - vulnerabilities_detail.json
  - console_report.txt
```

---

## ğŸ“Š ç»Ÿè®¡ä¿¡æ¯ç¤ºä¾‹

```json
{
  "total_vulns": 4,
  "by_severity": {
    "High": 2,
    "Medium": 1,
    "Low": 1
  },
  "by_type": {
    "SQLi": 2,
    "XSS": 2
  },
  "by_param": {
    "id": 2,
    "name": 1,
    "category": 1
  },
  "avg_confidence": 0.79,
  "risk_index": 23.50,
  "high_risk_count": 2,
  "medium_risk_count": 1,
  "low_risk_count": 1
}
```

---

## âš¡ ä½¿ç”¨ç¤ºä¾‹

### æ–¹æ³•1ï¼šåˆ†æ­¥åˆ†æ
```python
from Fuzz.BaseFuzz.analysis.analyzer import Analyzer
from Fuzz.BaseFuzz.analysis.reporter import Reporter

# 1. åŠ è½½å¹¶åˆ†æ
analyzer = Analyzer()
results, stats = analyzer.analyze('Results/scan/vulnerabilities.json')

# 2. ç”ŸæˆæŠ¥å‘Š
reporter = Reporter(output_dir='Results/scan_final')
scan_info = {...}  # ä»Engineè·å–
reporter.generate_summary(results, stats, scan_info)

# 3. æ‰“å°ç»ˆç«¯æ±‡æ€»
reporter.print_console_summary(stats, scan_info)
reporter.print_vulnerability_table(results, top_n=20)
```

### æ–¹æ³•2ï¼šä¸€é”®é›†æˆï¼ˆæ¨èï¼‰
```python
from Fuzz.BaseFuzz.analysis import Analyzer, Reporter

# å®Œæ•´æµç¨‹
analyzer = Analyzer()
results, stats = analyzer.analyze('Results/scan/vulnerabilities.json')

reporter = Reporter()
reporter.generate_summary(results, stats, scan_info)
reporter.print_console_summary(stats, scan_info)
reporter.print_vulnerability_table(results)
```

---

## ğŸ” é›†æˆæµ‹è¯•

è¿è¡Œé›†æˆæµ‹è¯•ï¼š
```bash
python Fuzz/BaseFuzz/analysis/test_analysis_integration.py
```

**æµ‹è¯•å†…å®¹**ï¼š
1. åˆ›å»ºæµ‹è¯•æ•°æ®ï¼ˆ6æ¡æ¨¡æ‹Ÿæ¼æ´ï¼‰
2. æ‰§è¡Œå»é‡ï¼ˆ6æ¡ â†’ 4æ¡ï¼‰
3. æ‰§è¡Œé‡è¯„çº§
4. ç”Ÿæˆç»Ÿè®¡ä¿¡æ¯
5. ç”ŸæˆJSONæŠ¥å‘Š
6. æ‰“å°ç»ˆç«¯å½©è‰²æ±‡æ€»
7. æ˜¾ç¤ºTop 3é«˜å±æ¼æ´

**é¢„æœŸè¾“å‡º**ï¼š
```
======================================================================
          CVDBFuzz æ‰«æç»“æœåˆ†æä¸æŠ¥å‘Šç”Ÿæˆ
======================================================================

âœ… æµ‹è¯•æ•°æ®å·²åˆ›å»º: Results/test_vulnerabilities.json

ğŸ“Š ç¬¬ä¸€æ­¥ï¼šç»“æœåˆ†æ
----------------------------------------------------------------------
âœ… åˆ†æå®Œæˆ:
   åŸå§‹ç»“æœ: 6æ¡
   å»é‡å: 4æ¡
   æ€»æ¼æ´: 4ä¸ª
   é«˜å±: 2ä¸ª
   ä¸­å±: 1ä¸ª
   ä½å±: 1ä¸ª
   é£é™©æŒ‡æ•°: 23.5

ğŸ“ ç¬¬äºŒæ­¥ï¼šæŠ¥å‘Šç”Ÿæˆ
----------------------------------------------------------------------
âœ… æŠ¥å‘Šç”ŸæˆæˆåŠŸ
...
```

---

## âœ… å¥å£®æ€§éªŒè¯

### æµ‹è¯•åœºæ™¯

**1. æ–‡ä»¶æŸå**ï¼š
```python
# vulnerabilities.json åŒ…å«æ— æ•ˆJSON
analyzer.load_results('damaged.json')
# è¿”å›: False
# ç»“æœ: analyzer.results = []
# æ—¥å¿—: "[ANALYZER] JSONè§£æå¤±è´¥"
```

**2. æ–‡ä»¶ä¸ºç©º**ï¼š
```python
# vulnerabilities.json å¤§å°ä¸º0
analyzer.load_results('empty.json')
# è¿”å›: True
# ç»“æœ: analyzer.results = []
# æ—¥å¿—: "[ANALYZER] æ–‡ä»¶ä¸ºç©º"
```

**3. æ•°æ®æ ¼å¼é”™è¯¯**ï¼š
```python
# æŸäº›ç»“æœç¼ºå°‘å¿…éœ€å­—æ®µ
analyzer.deduplicate()
# è¡Œä¸º: è·³è¿‡é”™è¯¯é¡¹ï¼Œä¿ç•™æ­£ç¡®é¡¹
# æ—¥å¿—: "[ANALYZER] å»é‡å¤„ç†å¤±è´¥"
```

---

## ğŸ“ ä»£ç ç»Ÿè®¡

| æ–‡ä»¶ | è¡Œæ•° | åŠŸèƒ½ |
|-----|------|------|
| analyzer.py | 550è¡Œ | ç»“æœåˆ†æå™¨ |
| reporter.py | 600è¡Œ | æŠ¥å‘Šç”Ÿæˆå™¨ |
| test_analysis_integration.py | 200è¡Œ | é›†æˆæµ‹è¯• |
| __init__.py | 20è¡Œ | åŒ…åˆå§‹åŒ– |
| **æ€»è®¡** | **~1370è¡Œ** | **å®Œæ•´ç³»ç»Ÿ** |

---

**å®ç°æ—¥æœŸ**ï¼š2025-12-25
**å®ç°è€…**ï¼šè€ç‹ (æš´èºæŠ€æœ¯æµ)
**çŠ¶æ€**ï¼šâœ… å®Œæˆå¹¶å¯ç”¨
